<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="logdigest_tools_reset_logdigest" version_id="2010170" version_string="2.1.1"><![CDATA[<xf:title>{{ phrase('logdigest_reset_logdigest') }}</xf:title>

<xf:if is="$messages">
	<xf:foreach loop="$messages" value="$message">
		<div class="blockMessage blockMessage--{$message.type}">{{ $message.message }}</div>
	</xf:foreach>
</xf:if>

<xf:form action="{{ link('tools/reset-logdigest') }}" class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('logdigest_choose_logs') }}</h2>
		<div class="block-body">
			<xf:checkboxrow label="{{ phrase('logdigest_logs') }}"
							hint="{{ phrase('logdigest_reset_hint') }}" >
				<xf:foreach loop="$types" key="$type" value="$log">
					<xf:option label="{{ phrase('logdigest_log_type_last_checked', {
									  	'name': $log.name,
									  	'lastupdated': $log.lastchecked ? $log.lastchecked : 'never',
									  	'lastid': $log.lastid ? $log.lastid : 'none'
									  }) }}"
							   name="options[{$type}]" />
				</xf:foreach>	
			</xf:checkboxrow>
			
		</div>		
		<xf:submitrow submit="{{ phrase('logdigest_reset') }}" />
	</div>
</xf:form>]]></template>
  <template type="admin" title="logdigest_tools_test_logdigest" version_id="2010170" version_string="2.1.1"><![CDATA[<xf:title>{{ phrase('logdigest_test_logdigest') }}</xf:title>

<xf:if is="$messages">
	<xf:foreach loop="$messages" value="$message">
		<div class="blockMessage blockMessage--{$message.type}">{{ $test }} - {{ $message.message }}</div>
	</xf:foreach>
</xf:if>
<xf:if is="$results">
	<div class="blockMessage blockMessage--success">{{ $test }} - {{ phrase('logdigest_all_tests_passed') }}</div>
</xf:if>

<xf:form action="{{ link('tools/test-logdigest') }}" class="block">
	<div class="block-container">
		<h2 class="block-header">{{ phrase('logdigest_send_test_email') }}</h2>
		<div class="block-body">
			<xf:textboxrow label="{{ phrase('email') }}" 
						   name="options[email]" 
						   value="{$options.email}" 
						   hint="{{ phrase('logdigest_test_email_hint') }}" />
			
			<xf:checkboxrow standalone="true" 
							label="{{ phrase('logdigest_options') }}">
				<xf:option label="{{ phrase('logdigest_generate_test_exception') }}"
						   hint="{{ phrase('logdigest_test_exception_hint') }}" 
						   name="options[generate]" 
						   selected="{$options.generate}" />
			</xf:checkboxrow>
			
		</div>		
		<xf:submitrow submit="{{ phrase('logdigest_test') }}" />
	</div>
	<xf:hiddenval name="test">Hampel\LogDigest:DigestTest</xf:hiddenval>
</xf:form>]]></template>
  <template type="admin" title="option_template_logdigestServerError" version_id="2000070" version_string="2.0.0"><![CDATA[<xf:checkboxrow
	label="{$option.title}"
	hint="{$hintHtml}"
	explain="{$explainHtml}"
	html="{$listedHtml}">

	<xf:option name="{$inputName}[enabled]" value="1" selected="$option.option_value.enabled"
		label="{{ phrase('logdigest_enable_server_error_log') }}" data-hide="true">
		<xf:dependent>
			
			<dl class="inputLabelPair">
				<dt><label for="{$inputName}_0">{{ phrase('logdigest_email_frequency') }}</label></dt>
				<dd><xf:numberbox name="{$inputName}[frequency]" value="{$option.option_value.frequency}" id="{$inputName}_0" min="1" /></dd>
			</dl>
			<p class="formRow-explain">{{ phrase('logdigest_frequency_explain') }}</p>
			
			<dl class="inputLabelPair">
				<dt><label for="{$inputName}_1">{{ phrase('logdigest_log_limit') }}</label></dt>
				<dd><xf:numberbox name="{$inputName}[limit]" value="{$option.option_value.limit}" id="{$inputName}_1" min="0" /></dd>
			</dl>
			<p class="formRow-explain">{{ phrase('logdigest_limit_explain') }}</p>		
		</xf:dependent>
		
		<xf:dependent>
			<div>{{ phrase('logdigest_deduplicate:') }}</div>
			<xf:checkbox>
				<xf:option name="{$inputName}[deduplicate]" value="1" selected="$option.option_value.deduplicate">
					{{ phrase('logdigest_deduplicate_explain') }}
				</xf:option>
			</xf:checkbox>
		</xf:dependent>		
	</xf:option>
</xf:checkboxrow>]]></template>
  <template type="email" title="logdigest_server_error" version_id="2010170" version_string="2.1.1"><![CDATA[<mail:subject>
	<xf:if is="$test">{{ phrase('logdigest_test_prefix') }} </xf:if>{{ phrase('logdigest_email_subject', {
		'type': $type,
		'board': $xf.options.boardTitle
	}) }}
</mail:subject>

{{ phrase('logdigest_recent_logs', {
	'type': '<a href="' . link_type('admin', 'canonical:' . $route) . '">' . $type . '</a>',
	'board': '<a href="' . link('canonical:index') . '">' . $xf.options.boardTitle . '</a>'
}) }}<br />
<xf:if is="$test">{{ phrase('logdigest_test_message') }}</xf:if>
<br />
<xf:if is="$logs is not empty">
	<xf:foreach loop="$logs" value="$entry">
		<hr />
		<xf:set var="$id" value="{$entry.getEntityId()}" />		
		<xf:if is="{$extra.{$id}.duplicate}">
			<b>{{ phrase('logdigest_duplicate_entry') }}</b>: {{ $extra.{$id}.date }}
		<xf:else />		
			<h2>{$entry.exception_type}</h2>
			<b>{{ phrase('logdigest_message') }}</b>: {$entry.message}<br />
			<b>{{ phrase('logdigest_file') }}</b>: <span style="font-family: monospace;">{$entry.filename}:{$entry.line|number}</span><br />
			<b>{{ phrase('generated_by') }}</b>: {{ $entry.User ? '<a href="' . link_type('admin', 'canonical:users/edit', $entry.User) . '">' . $entry.User.username . '</a>' : phrase('unknown_account') }}<br />
			<b>{{ phrase('logdigest_log_date') }}</b>: {{ $extra.{$id}.date }}<br />
			<div style="text-align: center;"><a href="{{ link_type('admin', 'canonical:' . $route, $entry) }}" class="button">{{ phrase('logdigest_view_this_error') }}</a></div>
			<h2>{{ phrase('stack_trace') }}</h2>
			<pre style="font-family: monospace; word-wrap: break-word; white-space: pre-wrap;">{$entry.trace_string}</pre>
			<h2>{{ phrase('request_state') }}</h2>
			{{ dump_simple($entry.request_state) }}<br />
		</xf:if>
	</xf:foreach>
<xf:else />
	{{ phrase('logdigest_no_logs_found') }}
</xf:if>]]></template>
</templates>
